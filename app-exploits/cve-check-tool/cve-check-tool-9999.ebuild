# Copyright 1999-2017 The Bentoo Authors. All rights reserved
# Distributed under the terms of the GNU General Public License v3 or later

EAPI=6

inherit autotools

DESCRIPTION="${PN} is a tool for checking known (public) CVEs."
HOMEPAGE="https://github.com/ikeydoherty/cve-check-tool"

if [[ ${PV} == "9999" ]] ; then
	inherit git-r3
	EGIT_REPO_URI="https://github.com/clearlinux/${PN}.git"
	KEYWORDS=""
else
	SRC_URI="https://github.com/clearlinux/${PN}/releases/download/v${PV}/${P}.tar.xz"
	KEYWORDS="~alpha ~amd64 ~arm ~hppa ~ia64 ~mips ~ppc ~ppc64 ~sparc ~x86 ~x86-fbsd ~amd64-linux ~x86-linux ~ppc-macos ~x64-macos ~x86-macos ~sparc-solaris"
fi

LICENSE="GPL-2"
SLOT="0"
IUSE="static-libs"
RESTRICT="test"

RDEPEND="app-misc/ca-certificates"
DEPEND="
	${RDEPEND}
	dev-libs/check
	dev-libs/glib
	dev-libs/json-glib
	net-misc/curl
	dev-libs/libxml2
	dev-db/sqlite
	dev-libs/openssl
	>=sys-devel/automake-1.14.1-r1:1.14
"

src_prepare(){
	default

	eautoreconf
}

src_configure() {
	econf \
		--disable-coverage \
		--enable-relative-plugins \
		$(use_enable static-libs static)
}

src_install() {
	default

	# remove .la file
	find "${ED}" -iname '*.la' -exec rm -f {} + || die
}
